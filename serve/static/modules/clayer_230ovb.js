/**/_jsload2&&_jsload2('clayer', 'x.extend(tb.prototype,{kl:{},Mj:[],Ou:"",wq:"",EG:"",ll:s,Vg:s,Ug:s,Tg:[],DG:0,kz:ca(),fz:ca(),Ku:ca(),Fd:function(){this.LG()},za:function(a,b){Gd.prototype.za.call(this,a,b);this.kl={};this.Mj=[];this.P=a;this.LG()},Bt:fa(q),remove:function(){Gd.prototype.remove.call(this);this.KT()},LG:function(){var a=this,b=a.P;b&&(this.kz=function(b){a.aT(b)},this.fz=function(b){a.CS(b)},this.Ku=function(b){a.BS(b)},b.addEventListener("mousemove",this.kz),b.addEventListener("onhotspotover",this.fz),b.addEventListener("onhotspotout", this.Ku),b.addEventListener("onzoomstart",this.Ku))},KT:function(){var a=this.P;a&&(a.removeEventListener("mousemove",this.kz),a.removeEventListener("onhotspotover",this.fz),a.removeEventListener("onhotspotout",this.Ku))},aT:function(a){var b=this,c=b.P,e=c.ya();if(c.la()<this.kc||c.Wd())b.mB();else if(a=e.vj().Ig(a.point),e=e.Pd(),a=new Q(Math.floor(a.x*Math.pow(2,c.la()-18)),Math.floor(a.y*Math.pow(2,c.la()-18))),e=new Q(Math.floor(a.x/e),Math.floor(a.y/e)),this.wq=c=e.x+"_"+e.y+"_"+c.la(),this.kl[c]){if(this.Ou!= c){b.mB();b.KG(this.kl[c]);this.Ou=c;for(var e=-1,a=0,f=this.Mj.length;a<f;a++)if(c==this.Mj[a]){e=a;break}0<=e&&(this.Mj.splice(e,e),this.Mj.push(c))}}else if(this.EG!=c){this.EG=c;e=Od[parseInt(Math.random()*Od.length)];a=b.fb;c=e+"/data?grids="+c+"&q="+a.Vt+"&tags="+a.wO+"&filter="+a.filter+"&sortby="+a.nO+"&ak="+a.$B+"&page_size="+a.zN+"&age="+a.SJ;b.If?c+="&geotable_id="+b.If:b.Sn&&(c+="&databox_id="+b.Sn);var g=(1E5*Math.random()).toFixed(0);!A._rd&&(A._rd={});A._rd["_cbk"+g]=function(a){b.uS(a); delete A._rd["_cbk"+g]};sa(c+("&callback=BMap._rd._cbk"+g))}},uS:function(a){var b=this.P,c=a.content;if(!(a.status!=this.DG||!c||1>c.length)){for(var a=[],e=c[0].data,b=b.ya().vj(),f=0,g=e.length;f<g;f++){var i=e[f][2].replace(tb.VT,"").split(","),i=b.yh(new L(i[0],i[1]));a.push({pt:i,userdata:{name:e[f][0]||"name",size:e[f][4]?e[f][4].split("|"):[10,13],uid:e[f][1]||"",Xb:e[f][3]||"sid1"}})}c=c[0].grid.join("_");this.kl[c]=a;this.Mj.push(c);30<this.Mj.length&&(c=this.Mj.shift(),delete this.kl[c], delete c);this.Ou!=this.wq&&(this.mB(),this.kl[this.wq]&&(this.KG(this.kl[this.wq]),this.Ou=this.wq))}},KG:function(a){for(var b=this.P,c=0,e=a.length;c<e;c++){var f=a[c].userdata.size,g=f[0]/2,f=f[1]/2,g=new nb(a[c].pt,{offsets:[f,g,f,g],userData:a[c].userdata});b.SB(g,this.fb.aE)}},mB:function(){this.P.Rw(this.fb.aE)},CS:function(a){if(a.spots&&!(1>a.spots.length||a.spots[0].tag!=this.fb.aE)){this.Tg=a.spots;var b=this,a=this.Tg[0].getUserData().size[0],c="",e=b.P,f="",g=b.fb.aZ;0<this.Tg.length&& (c=this.Tg[0].getUserData().name);if(this.Vg)this.Vg.va(this.Tg[0].ma()),this.Ug.Pc(c),this.Ug.Td(new M(a,0)),this.Vg.show(),c?this.Ug.show():this.Ug.aa();else{var i=this.Tg[0].getUserData().size,f=this.Tg[0].getUserData().Xb,k=this.If||this.Sn;this.ll=new kd(J.ta+"blank.gif",new M(i[0],i[1]),{anchor:new M(i[0]/2+1,i[1]/2+1)});this.lS(k,f,function(){b.Vg&&b.Vg.Wb(b.ll)});this.Vg=new W(this.Tg[0].ma(),{icon:this.ll,enableMassClear:t});e.Ra(this.Vg);this.Ug=new od(c,{offset:new M(a,0)});this.Ug.Ud({backgroundColor:g.backgroundColor, borderColor:g.borderColor});this.Vg.Gj(this.Ug);c?this.Ug.show():this.Ug.aa();this.Vg.addEventListener("onclick",function(){if(!(b.Tg.length<1)&&b.Tg[0].getUserData().uid){var a=b.fb,c=a.sY;if(b.If)c=a.tY;a=c+b.Tg[0].getUserData().uid+"?scope=2&ak="+a.$B;b.If&&(a=a+("&geotable_id="+b.If));var e=(Math.random()*1E5).toFixed(0);!A._rd&&(A._rd={});A._rd["_cbk"+e]=function(a){b.kS(a);delete A._rd["_cbk"+e]};sa(a+("&callback=BMap._rd._cbk"+e))}})}}},kS:function(a){var b=a.content;this.If&&(b=a.contents[0]); if(a&&a.status==this.DG&&b){var a={poiId:b.uid||"",databoxId:b.databox_id||"",title:this.If?b.title:b.name,address:this.If?b.address:b.addr,phoneNumber:b.tel||"",postcode:b.zip||"",provinceCode:1*b.province_id||-1,province:b.province||"",cityCode:1*b.city_id||-1,city:b.city||"",districtCode:1*b.district_id||-1,district:b.district||"",point:this.If?new L(b.location[0],b.location[1]):new L(b.longitude,b.latitude),tags:b.tag&&b.tag.replace(tb.YT,"").split(tb.WT),typeId:1*b.cla||-1,extendedData:b.ext|| {}},c=new x.lang.Ju("onhotspotclick");c.customPoi=a;c.content=b;this.dispatchEvent(c)}},BS:function(){this.Vg&&this.Vg.aa();this.Ug&&this.Ug.aa()},lS:function(a,b,c){var e=this,f=Pd+"?method=getstyle&databox="+a+"&sid="+b,g=(1E5*Math.random()).toFixed(0);if(!e.ll||!(e.ll.databoxid==a&&e.ll.sid==b))!A._rd&&(A._rd={}),A._rd["_cbk"+g]=function(a){var b="";0==a.status&&(b="data:image/png;base64,"+a.content.sid1);0<b.length&&(e.ll.YN(b),c&&c(a));delete A._rd["_cbk"+g]},sa(f+("&callback=BMap._rd._cbk"+ g))}}); ');
